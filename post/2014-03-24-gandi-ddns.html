<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="박연오의 개인 웹 페이지. 컴퓨터 프로그래밍 등."><title>간디 도메인(gandi.net) DDNS 설정 | 박연오</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">박연오</a><span class="subtitle">bakyeono.net</span><label id="toggle-menu" for="menu" onclick><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">home</a><a href="/archive" class="sidebar-nav-item">archive</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>간디 도메인(gandi.net) DDNS 설정</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2014-03-24</div><div class="post-tags"><a class="post-tag-link" href="/tag/네트워크/">네트워크</a>/<a class="post-tag-link" href="/tag/도메인/">도메인</a></div></div></div><article><div class="container post"><p><a href="https://www.gandi.net/no-bullshit" target="_blank" rel="external">No bullshit™</a> 정책이 마음이 들어서 간디 도메인(<a href="https://www.gandi.net" target="_blank" rel="external">gandi.net</a>)을 쓰고 있다. 다른 건 나름 좋은데 얼마전 <a href="http://ko.wikipedia.org/wiki/DDNS" target="_blank" rel="external">DDNS</a> 설정할 일이 있어 알아보니 아쉽게도 간디 도메인은 DDNS 설정을 지원하지 않는다고 한다!</p>
<p>하지만 대신 <a href="http://ko.wikipedia.org/wiki/%EB%8F%84%EB%A9%94%EC%9D%B8_%EB%84%A4%EC%9E%84_%EC%8B%9C%EC%8A%A4%ED%85%9C" target="_blank" rel="external">DNS 구역</a> 설정을 수정할 수 있는 웹 API가 제공된다. 그리고 이 API를 쉽게 이용할 수 있도록 하는 <a href="https://github.com/lembregtse/gandi-dyndns" target="_blank" rel="external">파이썬 프로그램</a>도 누군가가 만들어놓았다.</p>
<p>이것들을 이용하니 간디 도메인 사용자도 DDNS 업데이트가 어렵지 않다.</p>
<h2 id="준비물"><a href="#준비물" class="headerlink" title="준비물"></a>준비물</h2><ul>
<li>간디 도메인</li>
<li>리눅스가 설치된 서버</li>
</ul>
<h2 id="간디-도메인-사이트에서-API-키-발급"><a href="#간디-도메인-사이트에서-API-키-발급" class="headerlink" title="간디 도메인 사이트에서 API 키 발급"></a>간디 도메인 사이트에서 API 키 발급</h2><p>먼저 간디 도메인 사이트에서 API 키를 발급받아야 한다. 아래 순서를 따르자.</p>
<h3 id="API-management-페이지-접속"><a href="#API-management-페이지-접속" class="headerlink" title="API management 페이지 접속"></a>API management 페이지 접속</h3><p>간디 도메인 사이트에 로그인한 다음 <a href="https://www.gandi.net/admin/api_key" target="_blank" rel="external">My Account -&gt; Account management -&gt; API management</a> 메뉴를 클릭한다.</p>
<h3 id="테스트-플랫폼용-API-키-발급"><a href="#테스트-플랫폼용-API-키-발급" class="headerlink" title="테스트 플랫폼용 API 키 발급"></a>테스트 플랫폼용 API 키 발급</h3><p>Activation of the API on the test platform (OT&amp;E) 섹션의 Status를 Activated로 지정하고, Change status 버튼을 누른다.</p>
<p>그러면 API 키 생성 중이라는 메시지가 나온다. 5~10분 정도 기다리면 키가 발급된다.</p>
<p><strong>주의: 키를 외부에 노출하지 말 것.</strong></p>
<h3 id="진짜-API-키-발급"><a href="#진짜-API-키-발급" class="headerlink" title="진짜 API 키 발급"></a>진짜 API 키 발급</h3><p>사실 테스트 플랫폼용 API 키는 필요없다. 다만 진짜 API 키는 먼저 테스트 플랫폼용 키를 받은 다음에 받을 수 있기 때문에 위의 과정을 거친 것이다. 이제 진짜 API 키를 발급받자.</p>
<p>Activation of the production API 섹션의 API XML Status를 Activated로 지정하고, 암호를 지정한 다음, Submit 버튼을 누른다.</p>
<p>그러면 이번에도 API 키 생성 중이라는 메시지가 나오고 5~10분 정도 기다리면 키가 발급된다.</p>
<p><strong>주의: 키를 외부에 노출하지 말 것.</strong></p>
<h2 id="갱신할-DNS-네임-만들어-두기"><a href="#갱신할-DNS-네임-만들어-두기" class="headerlink" title="갱신할 DNS 네임 만들어 두기"></a>갱신할 DNS 네임 만들어 두기</h2><h3 id="DNS-Zones-페이지-접속"><a href="#DNS-Zones-페이지-접속" class="headerlink" title="DNS Zones 페이지 접속"></a>DNS Zones 페이지 접속</h3><p>간디 도메인 사이트에 로그인한 다음 <a href="https://www.gandi.net/admin/domain/zone/list" target="_blank" rel="external">My Account -&gt; Services -&gt; Domains -&gt; DNS Zones</a> 메뉴를 클릭한다.</p>
<h3 id="DNS-Zones-설정-복사본-만들어-수정"><a href="#DNS-Zones-설정-복사본-만들어-수정" class="headerlink" title="DNS Zones 설정 복사본 만들어 수정"></a>DNS Zones 설정 복사본 만들어 수정</h3><p>수정할 DNS Zones 파일을 하나 열고, Create a new version 을 클릭해 새로운 DNS Zones 버전을 생성한다.</p>
<p>그후 Add 버튼을 눌러 관리하고자 하는 DNS 네임 레코드를 추가한다. 각 필드에 입력할 값은 다음과 같다.</p>
<ul>
<li>Type: A 선택</li>
<li>TTL: 설정값 유효기간. 즉, 갱신 주기다. 5분에서 3시간 등 다양하게 지정할 수 있다. 나는 15분으로 했다.</li>
<li>Name: www, home, blog, app 등 사용할 레코드 네임.</li>
<li>Value: 링크할 주소. 우리는 API를 통해 이 값을 꾸준히 수정할 것이다. 일단 잘 변경되는지 테스트를 하기 위해 대충 아무 ip 주소 또는 도메인을 입력해 두자. (예: 127.0.0.1, google.com 등)</li>
</ul>
<h3 id="새로-만든-복사본을-사용-버전으로-지정"><a href="#새로-만든-복사본을-사용-버전으로-지정" class="headerlink" title="새로 만든 복사본을 사용 버전으로 지정"></a>새로 만든 복사본을 사용 버전으로 지정</h3><p>Use this version 을 클릭해 이 버전을 사용하도록 지정한다.</p>
<h2 id="DNS-갱신-프로그램-설치와-설정"><a href="#DNS-갱신-프로그램-설치와-설정" class="headerlink" title="DNS 갱신 프로그램 설치와 설정"></a>DNS 갱신 프로그램 설치와 설정</h2><h3 id="gandi-dyndns-프로그램-설치"><a href="#gandi-dyndns-프로그램-설치" class="headerlink" title="gandi-dyndns 프로그램 설치"></a>gandi-dyndns 프로그램 설치</h3><p>터미널에서 다음을 입력한다.</p>
<pre><code>$ cd ~
$ git clone https://github.com/lembregtse/gandi-dyndns.git
$ sudo chown -R root:root gandi-dyndns
$ sudo mv gandi-dyndns /usr/local
</code></pre><p>설치 완료.</p>
<h3 id="gandi-dyndns-사용"><a href="#gandi-dyndns-사용" class="headerlink" title="gandi-dyndns 사용"></a>gandi-dyndns 사용</h3><p>gandi-dyndns 사용법은 다음과 같다.</p>
<pre><code>$ gandi-dyndns --api=APIKEY --domain=DOMAIN --record=RECORD
</code></pre><p>시험삼아 터미널에 이 명령을 입력해보자. 물론, APIKEY, DOMAIN, RECORD는 적절한 값으로 바꿔야 한다. 프로그램을 실행하고 잠시 기다리면 현재 IP가 도메인 서버의 네임 설정에 반영되고 그 결과가 터미널에 출력될 것이다. 이 부분이 제대로 안 되면 무언가 잘못 한 것이고 더 진행할 수 없으므로 잘 확인하자.</p>
<p>갱신이 된 후에도 도메인 네임 서버에서 이것이 적용되기까지는 시간이 걸릴 수 있으니 바로 되지 않는다고 조바심을 내지 말자.</p>
<h3 id="ddns-업데이트-스크립트-만들기"><a href="#ddns-업데이트-스크립트-만들기" class="headerlink" title="ddns 업데이트 스크립트 만들기"></a>ddns 업데이트 스크립트 만들기</h3><p>gandi-dyndns 프로그램을 그냥 써도 무방하지만, 나는 업데이트 설정을 쉽게 고치고 로그 기록도 남기기 위해서 간단한 쉘 스크립트를 짰다. 여러분도 이 스크립트를 복사해서 쓰면 편리할 것이다.</p>
<p>선호하는 편집기를 이용해 /usr/local/bin/update-ddns 텍스트 파일을 생성한다. root 권한이 필요하다. vim 사용자라면 다음과 같다.</p>
<pre><code>$ sudo vim /usr/local/bin/update-ddns
</code></pre><p>편집기가 실행되면 아래 코드를 입력하고 저장한다.</p>
<pre><code>#!/bin/sh
# config
UPDATER=&quot;/usr/local/gandi-dyndns/gandi-dyndns&quot;
LOG=&quot;/var/log/update-ddns.log&quot;
API=&quot;Your-API-Key&quot;
DOMAIN=&quot;yourdomain.net&quot;
RECORD=&quot;www&quot;

# update &amp; leave log
TIME_STAMP=$(date +&quot;%F %T&quot;)
RESULT=$($UPDATER --api=$API --domain=$DOMAIN --record=$RECORD --ipv4 2&gt;&amp;1)
echo [$TIME_STAMP $RECORD.$DOMAIN] $RESULT &gt;&gt; $LOG
</code></pre><p>위 스크립트에서 config 항목의 각 값은 알맞게 수정하자. API 에는 간디 API 키를, DOMAIN에는 자신의 도메인 주소를, RECORD에는 갱신하고자 하는 이름을 지정하면 된다.</p>
<p>다음으로, 아래와 같이 실행 권한을 설정한다.</p>
<pre><code>$ sudo chmod ug+x /usr/local/bin/update-ddns
</code></pre><h3 id="crontab에-등록"><a href="#crontab에-등록" class="headerlink" title="crontab에 등록"></a>crontab에 등록</h3><p>다음 명령을 실행해 crontab 편집기를 실행한다.</p>
<pre><code>$ sudo crontab -e
</code></pre><p>편집기가 실행되면, 마지막 줄에 다음 줄을 입력하고 저장한다.</p>
<pre><code>*/15 * * * * /usr/local/bin/update-ddns
</code></pre><p>참고로 여기서 맨 앞의 <code>*/15</code>는 매 15분마다 이 명령을 실행하라는 뜻이다. 5분에 한 번씩 갱신하고 싶으면 <code>*/5</code>로 바꾸면 된다.</p>
<h3 id="로그-확인하기"><a href="#로그-확인하기" class="headerlink" title="로그 확인하기"></a>로그 확인하기</h3><p>ddns 갱신 기록이 잘 이루어지고 있는지 확인하고 싶다면 다음과 같이 /var/log/update-ddns.log 파일을 열어보면 된다.</p>
<pre><code>$ less /var/log/update-ddns.log
[2014-03-24 19:30:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 19:45:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 20:00:01 home.bakyeono.net] Can&apos;t find address for record type &apos;A&apos;
[2014-03-24 20:15:02 home.bakyeono.net] Can&apos;t find address for record type &apos;A&apos;
[2014-03-24 20:30:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 20:45:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 21:00:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 21:15:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 21:30:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
[2014-03-24 21:45:01 home.bakyeono.net] The IP for &apos;home&apos; did not change
/var/log/update-ddns.log (END)
</code></pre></div><!-- comment system--><div class="container"><hr></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:bakyeono@gmail.com" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="https://github.com/bakyeono" target="_blank"><i class="fa fa-github"></i></a><a href="http://feeds.feedburner.com/bakyeono" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2016 <a href="/" rel="nofollow">박연오</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});</script></body></html>